$(document).ready(function() {
    var e = $(".navbar-products .owl-carousel");
    e.owlCarousel({
        center: true,
        items: 7,
        loop: true,
        autoWidth: true,
        mouseDrag: false,
        dots: false,
        nav: false,
        smartSpeed: 1e3
    });
    e.on("changed.owl.carousel", function(o) {
        var t = o.relatedTarget.current(),
            r = e.find(".owl-item").eq(t).find("a").attr("class"),
            s = $('.product-info[data-info="' + r + '"]');
        $(".product-info").removeClass("active");
        setTimeout(function() {
            s.addClass("active")
        }, 300)
    });
    $(".navbar-products .owl-item").on("click", function() {
        e.trigger("to.owl.carousel", $(this).index())
    });
    $(".section-news .owl-carousel").owlCarousel({
        items: 2,
        loop: true,
        dots: true,
        nav: true,
        responsive: {
            0: {
                items: 1,
                nav: false
            },
            768: {
                items: 2,
                nav: true
            }
        }
    });
    $(".section-product-solutions .owl-carousel, .section-product-diferenciais .owl-carousel").owlCarousel({
        items: 1,
        loop: true,
        dots: true,
        nav: true,
        responsive: {
            0: {
                margin: 10
            },
            769: {
                margin: 0
            }
        }
    });

    $(".js-first-carossel, .js-large-carossel").owlCarousel({
        dots: false,
        arrows: false,
        items: 1,
        smartSpeed: 1e3,
        URLhashListener:true,
        autoplayHoverPause:false,
        startPosition: 'URLHash',
        infinite: true,
        margin: 25,
        mouseDrag: false,
        touchDrag: false
    });

    $(".js-last-carossel").owlCarousel({
        dots: false,
        arrows: false,
        items: 2,
        smartSpeed: 1e3,
        URLhashListener:true,
        autoplayHoverPause:false,
        startPosition: 'URLHash',
        infinite: true,
        margin: 25,
        mouseDrag: false

    });

    $("[data-gif-image]").click(function(){

    	var _target = $(this).attr("data-gif-image");

    	$(".js-gif-products").stop().animate({

    		opacity: "0"

    	}, 120, function(){

    		$("#" + _target).stop().animate({

	    		opacity: "1"

	    	}, 120);

    	});

    });

});

var _count = 1,
    _click = false;

if(!_click && window.top.location.hash != ""){
    window.top.location = window.top.location.href.split("#")[0];
}

$(".js-nav-prev").click(function(){
    if(_count != 1){
        _count -= 1;
    }
    $(this).attr("href", "#"+_count);
    $(".js-nav-next").attr("href", "#"+(_count + 1));
    $(".c-dots").removeClass("active");
    $(".c-dots a[href='#"+_count+"']").parent().addClass("active");
    });

$(".js-nav-next").click(function(){
    if(_count < 4){
        _count += 1;
    }
    $(this).attr("href", "#"+_count);
    $(".js-nav-prev").attr("href", "#"+(_count - 1));
    $(".c-dots").removeClass("active");
    $(".c-dots a[href='#"+_count+"']").parent().addClass("active");
});

$(".c-dots a").click(function(){
    $(".c-dots").removeClass("active");
    $(this).parent().addClass("active");
    var __pos = parseInt($(this).attr("href").replace("#", ""));
    _count = __pos;

    if(__pos == 4){
        $(".js-nav-prev").attr("href", "#"+(_count - 1));
        $(".js-nav-next").attr("href", "#"+(_count));
    }else if(__pos == 1){
        $(".js-nav-prev").attr("href", "#"+(_count));
        $(".js-nav-next").attr("href", "#"+(_count + 1));
    }else{
        $(".js-nav-prev").attr("href", "#"+(_count - 1));
        $(".js-nav-next").attr("href", "#"+(_count + 1));
    }
});

$(document).on('click', '.close-overlay-demo', function() {
    var mbackdrop = parent.document.getElementById('mbackdrop'),
        overlay = $('#mbackdrop').next();
    $(mbackdrop).animate({ opacity: 0 }, 600);
    $(overlay,'#overlay-demo, .text-overlay-demo').animate({
        opacity: 0
    }, 300, function() {
        overlay.remove();
        $('#overlay-demo, .text-overlay-demo').css('display','none');
        mbackdrop.style.display = 'none';
    });
});

$(document).on('click', '.social-overlays', function() {
    $('#mbackdrop').after('<iframe class="c-test" id="social-overlays" src="https://www.shopback.com.br/overlay/social-overlays.html" style="opacity:0;"></iframe>');
    $('#mbackdrop, #overlay-demo').css('display','block');
    $('#mbackdrop').animate({
        opacity: .8
    }, 300, function() {
        $('#social-overlays, #overlay-demo').animate({
            opacity: 1
        }, 200);
    });
});

$(document).on('click', '.on-site-alerts', function() {
    $('#mbackdrop').after('<iframe class="c-test" id="on-site-alerts" src="https://www.shopback.com.br/overlay/on-site-alerts.html" style="opacity:0;"></iframe>');
    $('#mbackdrop, #overlay-demo').css('display','block');
    $('#mbackdrop').animate({
        opacity: .2
    }, 300, function() {
        $('#on-site-alerts, #overlay-demo').animate({
            opacity: 1
        }, 200);
    });
});

$(document).on('click', '.overlay-recomendation', function() {
    $('#mbackdrop').after('<iframe class="c-test" id="overlay-recomendation" src="https://www.shopback.com.br/overlay/overlay-recomendation.html" style="opacity:0;"></iframe>');
    $('#mbackdrop, #overlay-demo').css('display','block');
    $('#mbackdrop').animate({
        opacity: .8
    }, 300, function() {
        $('#overlay-recomendation, #overlay-demo').animate({
            opacity: 1
        }, 200);
    });
});

$(document).on('click', '.stock-indicators', function() {
    $('#mbackdrop').after('<iframe class="c-test" id="stock-indicators" src="https://www.shopback.com.br/overlay/stock-indicators.html" style="opacity:0;"></iframe>');
    $('#mbackdrop, #overlay-demo').css('display','block');
    $('#mbackdrop').animate({
        opacity: .8
    }, 300, function() {
        $('#stock-indicators, #overlay-demo').animate({
            opacity: 1
        }, 200);
    });
});

$(document).on('click', '.overlays', function() {
    $('#mbackdrop').after('<iframe class="c-test" id="overlays" src="https://www.shopback.com.br/overlay/overlay/overlay.html" style="opacity:0;"></iframe>');
    $('#mbackdrop, #overlay-demo').css('display','block');
    $('#mbackdrop').animate({
        opacity: .8
    }, 300, function() {
        $('#overlays, #overlay-demo').animate({
            opacity: 1
        }, 200);
    });
});

$(document).on('click', '.survey-overlays', function() {
    $('#mbackdrop').after('<iframe class="c-test" id="survey-overlays" src="https://www.shopback.com.br/overlay/survey-overlays/overlay.html" style="opacity:0;"></iframe>');
    $('#mbackdrop, #overlay-demo').css('display','block');
    $('#mbackdrop').animate({
        opacity: .8
    }, 300, function() {
        $('#survey-overlays, #overlay-demo').animate({
            opacity: 1
        }, 200);
    });
});

$(document).on('click', '.social-overlay-product-recommendation', function() {
    $('#mbackdrop').after('<iframe class="c-test" id="social-overlay-product-recommendation" src="https://www.shopback.com.br/overlay/social-overlay-product-recommendation.html" style="opacity:0;"></iframe>');
    $('#mbackdrop, #overlay-demo').css('display','block');
    $('#mbackdrop').animate({
        opacity: .8
    }, 300, function() {
        $('#social-overlay-product-recommendation, #overlay-demo').animate({
            opacity: 1
        }, 200);
    });
});

$(document).on('click', '.product-recommendation-overlays', function() {
    $('#mbackdrop').after('<iframe class="c-test" id="personalized-recommendation" src="https://www.shopback.com.br/overlay/personalized-recommendation.html"></iframe>');
    $('#mbackdrop, #overlay-demo, .text-overlay-demo').css('display','block');
    $('#mbackdrop').animate({ opacity: .5 }, 300);
    $('#overlay-demo, .text-overlay-demo').animate({ opacity: 1 }, 300);
    $('#personalized-recommendation').animate({
        bottom: 0,
    }, 500, function() {
        var lastScrollTop = 0;
        var blocked = false;
        $(window).scroll(function(event){
            var st = $(this).scrollTop();
            if (st > lastScrollTop) {
                if(!blocked){
                    blocked = true;
                    $('#personalized-recommendation').animate({bottom: 0}, 300, function() {
                        blocked = false;
                    });
                }
            }else{
                if(!blocked){
                    blocked = true;
                    $('#personalized-recommendation').animate({bottom: -260}, 300, function() {
                        blocked = false;
                    });
                }
            }
            lastScrollTop = st;
        });
    });
});

$(document).on('click', '.overlay-recomendation-custom', function() {
    $('#mbackdrop').after('<iframe class="c-test" id="overlay-recomendation-custom" src="https://www.shopback.com.br/overlay/overlay-recomendation-custom.html" style="opacity:0;"></iframe>');
    $('#mbackdrop, #overlay-demo').css('display','block');
    $('#mbackdrop').animate({
        opacity: .8
    }, 300, function() {
        $('#overlay-recomendation-custom, #overlay-demo').animate({
            opacity: 1
        }, 200);
    });
});
